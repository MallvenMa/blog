<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Hello Code</title>
  <meta name="author" content="Mallven">

  
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://mallven.com/">
  <link href="/favicon.png" type="image/png" rel="icon">
  <link href="" rel="alternate" title="Hello Code" type="application/atom+xml">

  <link href="/assets/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet" type="text/css">
<link href="/assets/bootstrap/dist/css/bootstrap-theme.min.css" rel="stylesheet" type="text/css">
<link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">


  <script src="/javascripts/libs/jquery/jquery-2.0.3.min.js"></script>
  

</head>

  <body   >
    <div id="wrap">
      <header role="banner">
        <nav class="navbar navbar-default" role="navigation">
    <div class="container">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
            <a class="navbar-brand" href="/">Hello Code</a>
        </div>

        <div class="navbar-collapse collapse">
            <ul class="nav navbar-nav">
                <li class="active">
                    <a href="/">Blog</a>
                </li>
                <li >
                    <a href="/blog/archives">Archives</a>
                </li>
		<li >
                    <a href="/projects">Projects</a>
                </li>
		<li >
                    <a href="/reading">Reading</a>
                </li>	
		<li >
                    <a href="/about">About</a>
                </li>	
            </ul>
            <ul class="nav navbar-nav navbar-right">
                <li>
                    <a class="subscribe-rss" href="" title="subscribe via RSS">
                        <span class="visible-xs">RSS</span>
                        <img class="hidden-xs" src="/images/rss.png" alt="RSS">
                    </a>
                </li>
                
            </ul>
            
        </div>
    </div>
</nav>


      </header>
      <div id="main" class="container">
        <div id="content">
          <div class="row">
  <div class="page-content col-md-9">
    <div class="blog-index">
      
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2015-03-16T13:57:42+08:00" pubdate data-updated="true">Mar 16<span>th</span>, 2015</time>
        
        
          | <a href="/blog/2015/03/16/how-hashmap-works/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2015/03/16/how-hashmap-works/">How HashMap Works</a></h1>
    
  </header>


  <div class="entry-content clearfix"><h3>1.The Structure Of HashMap</h3>

<p>As we know,all structures of object in Java are based on array and reference,HashMap is same too. A HashMap structure consist of two parts:Array and LinkList(Figure 1).</p>

<p><img src="/images/blog/2015-03/20150316-hashmap-structure.png" alt="HashMap Structure" /></p>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2015/03/16/how-hashmap-works/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-21T18:02:59+08:00" pubdate data-updated="true">Jun 21<span>st</span>, 2014</time>
        
        
          | <a href="/blog/2014/06/21/netbeans-debug-hotspot/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/06/21/netbeans-debug-hotspot/">Netbeans Debug Hotspot</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>学习JVM的过程中肯定不能少了对JVM的调试，进行就学习一下怎样用Netbeans调试Hotspot。</p>

<h4>编译过程</h4>

<p>环境：</p>

<blockquote><p>Ubuntu12.04<br/>
OpenJdk 7u<br/>
Netbeans7.0.1(c/c++)</p></blockquote>

<p>1.安装编译所需要的工具。</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">apt</span><span class="o">-</span><span class="n">get</span> <span class="n">install</span> <span class="n">ant</span> <span class="n">mercurial</span> <span class="n">gawk</span> <span class="n">g</span><span class="o">++</span> <span class="n">libcups2</span><span class="o">-</span><span class="n">dev</span> <span class="n">libasound2</span><span class="o">-</span><span class="n">dev</span> <span class="n">libfreetype6</span><span class="o">-</span><span class="n">dev</span> <span class="n">libx11</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxt</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxext</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxrender</span><span class="o">-</span><span class="n">dev</span> <span class="n">libxtst</span><span class="o">-</span><span class="n">dev</span> <span class="n">libfontconfig1</span><span class="o">-</span><span class="n">dev</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/06/21/netbeans-debug-hotspot/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-15T10:01:00+08:00" pubdate data-updated="true">Jun 15<span>th</span>, 2014</time>
        
        
          | <a href="/blog/2014/06/15/java-object-create-2/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/06/15/java-object-create-2/">JVM 之 Java对象创建[初始化]</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>上一篇文章简单介绍了类的加载和连接阶段，今天来简单看一下类的初始化过程。<br/>
还是使用上文的例子:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">Class</span> <span class="n">claszz</span> <span class="o">=</span> <span class="n">clt</span><span class="o">.</span><span class="na">loadClass</span><span class="o">(</span><span class="s">&quot;Animal&quot;</span><span class="o">);</span>
</span><span class='line'><span class="n">Animal</span> <span class="n">animal</span> <span class="o">=</span> <span class="o">(</span><span class="n">Animal</span><span class="o">)</span><span class="n">claszz</span><span class="o">.</span><span class="na">newInstance</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p><code>newInstance</code>的native方法在:src/share/native/sun/reflect/NativeAccessors.c</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">JNIEXPORT</span> <span class="n">jobject</span> <span class="n">JNICALL</span> <span class="nf">Java_sun_reflect_NativeConstructorAccessorImpl_newInstance0</span>
</span><span class='line'><span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="o">,</span> <span class="n">jclass</span> <span class="n">unused</span><span class="o">,</span> <span class="n">jobject</span> <span class="n">c</span><span class="o">,</span> <span class="n">jobjectArray</span> <span class="n">args</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'><span class="k">return</span> <span class="nf">JVM_NewInstanceFromConstructor</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="n">c</span><span class="o">,</span> <span class="n">args</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/06/15/java-object-create-2/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-06-14T08:53:49+08:00" pubdate data-updated="true">Jun 14<span>th</span>, 2014</time>
        
        
          | <a href="/blog/2014/06/14/java-object-create-1/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/06/14/java-object-create-1/">JVM 之 Java对象创建[加载和连接]</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>Java对象的生命周期可以分为：加载，验证，准备，解析，初始化，使用，卸载 八个阶段。其中验证，准备，解析又被统称为连接，今天主要是简单看一下加载和连接，下一篇文章讲初始化。<br/>
<img src="/images/blog/2014-06/20140614-java-load-pic.png" alt="对象生命周期" /><br/>
说明：</p>

<blockquote><p>本文章所涉及的代码Gist地址:<a href="https://gist.github.com/zarue/0d5f83fa8458a9298b9d">点击查看</a><br/>
本文使用是Jdk6u-Hotspot</p></blockquote>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/06/14/java-object-create-1/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-29T20:58:21+08:00" pubdate data-updated="true">May 29<span>th</span>, 2014</time>
        
        
          | <a href="/blog/2014/05/29/runtime-string-pool-2/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/05/29/runtime-string-pool-2/">JVM 之 String 常量池 二</a></h1>
    
  </header>


  <div class="entry-content clearfix"><p>上一篇文章<a href="/blog/2014/05/27/runtime-string-pool-1">JVM 之 String 常量池 一</a>中我们了解到JVM中有一个叫String常量池的东西，String常量池到底是什么样？，又是怎样工作的呢？今天就来看一下。<br/>
做任何事情都要首先找一个入口。我们怎么才能找到常量池的入口呢？<br/>
我们首先想到String里面有个intern方法，可以在运行时向常量池中动态添加字符串。我们就从这个方法入手。<br/>
先看String 的intern的源代码:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">native</span> <span class="n">String</span> <span class="nf">intern</span><span class="o">();</span>
</span></code></pre></td></tr></table></div></figure>


<p>这是一个native 方法，也就是这个方法不是用java实现的，要找到这个native 方法就要去<a href="http://openjdk.java.net/">JDK的源代码</a>中查找，它位于<code>openjdk/jdk/src/share/native/java/lang</code>目录中的<code>String.c</code>中。这个目录下还有许多其他java类中对应的native方法的实现，例如object类中的<code>hashCode</code>,<code>getClass</code>,<code>clone</code>等方法都在<code>Object.c</code>里面。 <br/>
String.c 中只有一个方法：</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="err">#</span><span class="n">include</span> <span class="s">&quot;jvm.h&quot;</span>
</span><span class='line'><span class="err">#</span><span class="n">include</span> <span class="s">&quot;java_lang_String.h&quot;</span>
</span><span class='line'><span class="n">JNIEXPORT</span> <span class="n">jobject</span> <span class="n">JNICALL</span>
</span><span class='line'><span class="nf">Java_java_lang_String_intern</span><span class="o">(</span><span class="n">JNIEnv</span> <span class="o">*</span><span class="n">env</span><span class="o">,</span> <span class="n">jobject</span> <span class="k">this</span><span class="o">)</span>
</span><span class='line'><span class="o">{</span>
</span><span class='line'><span class="k">return</span> <span class="nf">JVM_InternString</span><span class="o">(</span><span class="n">env</span><span class="o">,</span> <span class="k">this</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/05/29/runtime-string-pool-2/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-27T20:30:20+08:00" pubdate data-updated="true">May 27<span>th</span>, 2014</time>
        
        
          | <a href="/blog/2014/05/27/runtime-string-pool-1/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/05/27/runtime-string-pool-1/">JVM 之 String 常量池 一</a></h1>
    
  </header>


  <div class="entry-content clearfix"><h4>1.Sting对象创建方式</h4>

<p>JAVA里面创建字符串有两种方式：<br/>
1. 通过字符串常量方式:String a = &ldquo;a&rdquo;;<br/>
2. 通过new 关键字创建:new String(&ldquo;a&rdquo;);</p>

<p>但是这两种创建字符串的方式有很大的不同。<br/>
1. 使用第一种方式，jvm首先会检查字符串常量池中是否存在了这个常量，如果存在，就返回池中的实例引用。如果不存在，就会实例化一个字符串并放到池中,然后返回引用。<br/>
2. 使用第二种方式，则直接分配到heap中，不指向字符串常量池中的任何对象，和字符串常量池没有关系。</p>

<h4>2.下面来看一个例子: <a href="https://gist.github.com/zarue/25e0afedb33de86da650">本例子Gist地址</a></h4>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/05/27/runtime-string-pool-1/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-22T14:09:15+08:00" pubdate data-updated="true">May 22<span>nd</span>, 2014</time>
        
        
          | <a href="/blog/2014/05/22/jvm-object-structure/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/05/22/jvm-object-structure/">JVM 之 Java 对象结构</a></h1>
    
  </header>


  <div class="entry-content clearfix"><h2>1. Java对象在内存中到底是什么样?</h2>

<p>JAVA对象在内存中的表现形式就是一系列按照<em>某种规范</em>排列的字节(如果不清楚物理内存j的实现方式，请参考：<a href="http://blog.zarue.com/blog/2014/05/21/cpu-and-memory/">关于CPU寻址和物理内存结构</a> )。
那在JVM中这个规范是怎么定义的呢？
Hotspot虚拟机中，对象分为两大类：普通对象和数组对象，两类对象在内存中的布局可以分为三部分:<code>对象头，对象实例数据， 对齐填充</code> 。不同的是普通对象的对象头是由<code>MARK WORD，CLASS对象指针</code>两部分组成，而数组对象头是由<code>MARK WORD，CLASS对象指针，数组长度</code>三部分组成，如图:<br/>
<img src="/images/blog/2014-05/20140524-object-arrayObject-structure.png" alt="对象结构" /></p>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/05/22/jvm-object-structure/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-21T20:35:18+08:00" pubdate data-updated="true">May 21<span>st</span>, 2014</time>
        
        
          | <a href="/blog/2014/05/21/cpu-and-memory/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/05/21/cpu-and-memory/">关于CPU寻址和物理内存结构</a></h1>
    
  </header>


  <div class="entry-content clearfix"><h2>本文讨论的都是概念模型，实际实现方式肯定会有不同</h2>

<h3>1. 关于CPU的几个概念</h3>

<ol>
<li>数据总线：数据总线是CPU和其它组件（比如：内存）之间进行数据交互的通道。</li>
<li>数据总线宽度：是指CPU中寄存器的位数，即CPU位数，我们常说的32位，64位就是指的这个参数。CPU的位数和CPU的寻址能力没有关系。我们之前经常听到32位的CPU最大寻址能力是2<sup>32</sup> 因此它最大可识别的内存是4G，64位CPU可以识别4G以上内存，其实这是不正确的，因为CPU的寻址能力和CPU的位数没有关系。</li>
<li>地址总线：CPU是通过地址总线来进行内存寻址。</li>
<li>地址总线宽度：地址总线宽度决定了CPU的寻址范围，如果地址总线是32位，那么该CPU的寻址范围就是0-2<sup>32</sup>-1（0x00000000-0xFFFFFFFF），也就是4G个存储单元，如果存储单元是按字节编址，那么CPU可以寻址的最大内存量就是4G(byte)，这时候即使有再大的内存也不会被识别。</li>
<li>控制总线：主要是将CPU的控制指令传送到其它组件</li>
</ol>


<p>关于总线更详细的文章网上有很多，例如：</p>

<ul>
<li><a href="http://share.onlinesjtu.com/mod/tab/view.php?id=253">总线的内部结构</a></li>
<li><a href="http://my.oschina.net/u/158589/blog/70813">CPU位数，寻址能力，指令集，寄存器位数，操作系统位数</a></li>
</ul>


</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/05/21/cpu-and-memory/">Read All</a>
    </footer>
  


        </article>
      
      
        <article class="post">
          
  <header class="page-header">
    
      <p class="meta text-muted text-uppercase">
        












<span class="glyphicon glyphicon-calendar"></span> <time datetime="2014-05-18T22:05:24+08:00" pubdate data-updated="true">May 18<span>th</span>, 2014</time>
        
        
          | <a href="/blog/2014/05/18/vim-chinese-error/#comments">Comments</a>
         
      </p>
    
    
      <h1 class="entry-title"><a href="/blog/2014/05/18/vim-chinese-error/">Mac OSX Vim 输入中文乱码问题</a></h1>
    
  </header>


  <div class="entry-content clearfix"><h3>出现问题的环境:</h3>

<ol>
<li>OSX 10.9.2 英文</li>
<li>VIM 7.3</li>
</ol>


<h3>问题描述:</h3>

<ol>
<li>可以正常显示文件中得中文字符</li>
<li>输入中文字符会出现乱码</li>
<li>通过在.vimrc中设置编码格式无效</li>
</ol>


<h3>解决方案:</h3>

<p>找到 <code>Terminal--&gt;Preferences--&gt;Settings--&gt;Advanced--&gt;Escape non-ASCII input with Control-V</code> 取消该选项即可。</p>

</div>
  
  
    <footer>
      <a class="btn btn-default" rel="full-article" href="/blog/2014/05/18/vim-chinese-error/">Read All</a>
    </footer>
  


        </article>
      
    </div>

    <ul class="pager">
      
        <li class="previous disabled"><a href="#">&larr;&nbsp;Older</a></li>
      
      <li><a href="/blog/archives">Blog Archives</a></li>
      
        <li class="next disabled"><a href="#">Newer&nbsp;&rarr;</a></li>
      
    </ul>
  </div>

  
    <aside class="sidebar col-md-3">
      
        <section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Mallven</h3>
  </div>
  <div id="about_me" class="list-group">
  <div style="padding-top:15px;padding-bottom:15px;text-align:center">
	<span >What I have is the world</span>	  </div>
  <div class="social" style="text-align:center">
		 
                <a class="github" target="_blank"  href="https://github.com/zarue" title="GitHub">GitHub</a>
                		
		
		<a class="weibo" target="_blank"  href="http://www.weibo.com/2403887405" title="Weibo">Weibo</a>
		
		
		<a class="facebook" target="_blank"  href="http://www.facebook.com/yonghua.ma" title="Facebook">Facebook</a>
		
		
		
		<a class="twitter" target="_blank"  href="http://twitter.com/cheney_life" title="Twitter">Twitter</a>
		
		
		
		
		
		
		
	</div>  
</div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Recent Posts</h3>
  </div>
  
  <div id="recent_posts" class="list-group">
    
    <a class="list-group-item " href="/blog/2015/03/16/how-hashmap-works/">How HashMap Works</a>
    
    <a class="list-group-item " href="/blog/2014/06/21/netbeans-debug-hotspot/">Netbeans Debug Hotspot</a>
    
    <a class="list-group-item " href="/blog/2014/06/15/java-object-create-2/">JVM 之 Java对象创建[初始化]</a>
    
    <a class="list-group-item " href="/blog/2014/06/14/java-object-create-1/">JVM 之 Java对象创建[加载和连接]</a>
    
    <a class="list-group-item " href="/blog/2014/05/29/runtime-string-pool-2/">JVM 之 String 常量池 二</a>
    
  </div>
</section>
<section class="panel panel-default">
  <div class="panel-heading">
    <h3 class="panel-title">Categories</h3>
  </div>
  <div id="categories" class="list-group">
  <a class='list-group-item'  href='/blog/categories/java/'>java (1)</a>
<a class='list-group-item'  href='/blog/categories/jvm/'>jvm (6)</a>
<a class='list-group-item'  href='/blog/categories/system/'>system (1)</a>
<a class='list-group-item'  href='/blog/categories/vim/'>vim (1)</a>
 
 </div>
</section>





      
    </aside>
  
</div>

        </div>
      </div>
    </div>
    <footer role="contentinfo"><div class="container">
    <p class="text-muted credits">
  Copyright &copy; 2015 - Mallven<br>
  <small>
      <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>,
      <span class="credit">customized with <a href="https://github.com/kAworu/octostrap3">octostrap3</a></span>.
  </small>
</p>

</div>
</footer>
    <script src="/assets/bootstrap/dist/js/bootstrap.min.js"></script>
<script src="/javascripts/modernizr-2.0.js"></script>












  </body>
</html>
